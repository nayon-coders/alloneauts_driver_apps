import 'package:cloud_firestore/cloud_firestore.dart';import 'package:driver/view/single_car/single_cart.dart';import 'package:driver/widgets/car_list_view.dart';import 'package:firebase_auth/firebase_auth.dart';import 'package:firebase_storage/firebase_storage.dart';import 'package:flutter/material.dart';class AllCarHomeView extends StatefulWidget {  final String view;  final String? searchValue;  final String? rentType;  final List rentTypeList;  final double? minPrice;  final double? maxPrice;  const AllCarHomeView({Key? key, this.view = "short", this.searchValue ="", this.rentType, this.minPrice, this.maxPrice, required this.rentTypeList}) : super(key: key);  @override  State<AllCarHomeView> createState() => _AllCarHomeViewState();}class _AllCarHomeViewState extends State<AllCarHomeView> {  final GlobalKey<RefreshIndicatorState> _refreshIndicatorKey =  GlobalKey<RefreshIndicatorState>();  final FirebaseAuth _auth = FirebaseAuth.instance;  final FirebaseFirestore _firestore = FirebaseFirestore.instance;  @override  Widget build(BuildContext context) {    var size = MediaQuery.of(context).size;    return RefreshIndicator(        key: _refreshIndicatorKey,        color: Colors.white,        backgroundColor: Colors.blue,        strokeWidth: 4.0,        onRefresh: () async {          setState(() {});        },        child: StreamBuilder(      stream: _firestore.collection('vendor_cars').snapshots(),      builder: (context, snapshot) {        if(snapshot.connectionState == ConnectionState.waiting){          return Center(child: CircularProgressIndicator(),);        }else if(snapshot.hasData){          List<QueryDocumentSnapshot<Map<String, dynamic>>> carList = [];          if(widget.searchValue!.isNotEmpty){            for(var i in snapshot.data!.docs){              if(i["car_info"]["name"].toString().toLowerCase().contains(widget.searchValue!.toLowerCase())){                carList.add(i);              }            }          }else if(widget.rentTypeList.isNotEmpty){              for(var i in snapshot.data!.docs){                if(widget.rentTypeList!.contains(i["car_info"]["rent_type"])){                  carList.add(i);                }              }            }else{              //add all car to list              for(var i in snapshot.data!.docs){                carList.add(i);              }            }          print("carList: ${carList.length}");          return carList.isNotEmpty ?  ListView.builder( //ListView.builder            shrinkWrap: true,            physics: NeverScrollableScrollPhysics(),            itemCount: widget.view == "All" ?  carList.length : carList.length > 11 ? 10 : carList.length,            itemBuilder: (_, index){              return CarListView( //CarListView                size: size,                carId: carList[index]["car_info"]["car_id"],                data: carList[index].data(),                onClick: ()=>Navigator.push(context, MaterialPageRoute(builder: (context)=> SingleCar(singleCar: carList[index], ))),                image: "${carList[index]["car_info"]["images"]["carImage"]}", //carList[index]["car_info"]["image"][0],                name: "${carList[index]["car_info"]["name"]}",                amount: "${carList[index]["car_info"]["price"]}",                rentReviews: "0",    //rentReviews: "67 Reviews",                totalReviews: "0",                rentVeriant: "${carList[index]["car_info"]["rent_type"]}",                onAddFav: (){},              );            },          ) : Center(child: Text("No data found."),);        }else{          return Center(child: Text("No data found"),);        }      }    ));  }}